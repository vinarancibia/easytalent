{% load i18n static %}
<style>

	.custom-dialog {
		max-width: 1000px;
		max-height: 800px;
	}

	.file-validation {
		color: #4f5bd9;
		background-color: #d8e7f0;
		border-color: #d6e9c6;
		padding: 15px;
		border: 1px solid transparent;
		border-radius: 4px;

	}
	.file-validation ul {
		margin-left: 15px;
	}

	.oh-not-found {
		display: flex;
		justify-content: center;
		align-items: center;
		flex-direction: column;
		height: 50vh;
		opacity: 0.5;
	}

	.file-upload {
		margin-top: 6px !important;
		width: 34px !important;
		height: 34px !important;
		font-size: 1.75rem !important;
	}
</style>
{% if perms.recruitment.add_candidatedocument or perms.recruitment.change_candidate %}
	<div class="oh-btn-group p-3 justify-between items-center">
		<span class="text-md font-semibold"> {% trans "Documents" %}</span>
		<div>
			<button
				class="oh-btn oh-btn--secondary"
				data-toggle="oh-modal-toggle"
				data-target="#objectCreateModal"
				hx-get="{% url 'candidate-document-create' candidate.id %}"
				hx-target="#objectCreateModalTarget"
				onclick="event.preventDefault()"

			>
				<ion-icon name="add-sharp" class="mr-2"></ion-icon>{% trans "Create" %}
			</button>
		</div>
	</div>
{% endif %}

{% if documents %}
	<div class="p-6">
		<div class="bg-white rounded-xl shadow-sm overflow-hidden">
			<div
				class="hidden md:grid grid-cols-[60px_1fr_120px_180px] gap-4 px-6 py-4 bg-slate-50 border-b border-slate-200 text-xs font-semibold uppercase tracking-wider text-slate-500 items-center"
			>
				<div></div>
				<div>{% trans "Document" %}</div>
				<div>{% trans "Status" %}</div>
				<div>{% trans "Actions" %}</div>
			</div>

			{% for document in documents %}
				<div
					class="grid md:grid-cols-[60px_1fr_120px_180px] gap-4 px-6 py-4 border-b border-slate-100 items-center hover:bg-slate-50 cursor-pointer
						{% if document.document %}
							{% if document.status == "approved" %}row-status--yellow
							{% elif document.status == 'rejected' %}row-status--red
							{% elif document.status == 'requested' %}row-status--blue
							{% endif %}
						{% endif %}
					"
					hx-get="{% url 'candidate-view-file' document.id %}"
					hx-target="#viewFile"
					data-toggle="oh-modal-toggle"
					data-target="#viewFileModal"
					id="document{{document.id}}"
				>
					{% if document.document %}
						{% if document.status == "approved" %}
							<div
								class="w-8 h-8 rounded-md bg-green-100 text-green-700 flex items-center justify-center shrink-0"
							>
								<ion-icon name="checkmark-outline"></ion-icon>
							</div>
						{% elif document.status == 'rejected' %}
							<div
								class="w-8 h-8 rounded-md bg-red-100 text-red-600 flex items-center justify-center shrink-0"
							>
								<ion-icon name="warning-outline"></ion-icon>
							</div>
						{% else %}
							<div
								class="w-8 h-8 rounded-md bg-blue-100 text-blue-600 flex items-center justify-center shrink-0"
							>
								<ion-icon name="document-text-outline"></ion-icon>
							</div>
						{% endif %}
					{% else %}
						<div
							class="w-8 h-8 rounded-md bg-amber-100 text-amber-700 flex items-center justify-center shrink-0"
						>
							<ion-icon name="cloud-upload-outline"></ion-icon>
						</div>
					{% endif %}

					<div class="w-full">
						<div class="title-wrapper">
							<div
								onclick="event.stopPropagation()"
								class="font-semibold text-slate-900 mb-1 hover:bg-slate-100 px-1 rounded inline-block {% if document.document_request_id %} cursor-pointer {% else %} cursor-text title-display {% endif %}">
								{{ document.title }}
							</div>

							<input type="text"
								name="title"
								data-id="{{document.id}}"
								class="hidden font-semibold text-slate-900 mb-1 cursor-text border border-slate-300 rounded px-2 py-1 focus:outline-none focus:ring focus:ring-blue-300 w-full title-input"
								value="{{ document.title }}"
								onclick="event.stopPropagation();"
							>
						</div>

						<div class="text-sm text-slate-500">
							{{document.document_request_id.description}}
						</div>
					</div>

					<div>
						<div
							class="text-sm font-medium px-3 py-1 rounded-xl text-center {% if document.document %} {% if document.status == 'approved' %}bg-green-100 text-green-700 {% elif document.status == 'rejected' %}bg-red-100 text-red-700 {% elif document.status == 'requested' %}bg-blue-100 text-blue-700 {% endif %} {% else %} bg-amber-100 text-amber-700 {% endif %}"
						>
							{% if document.document %} {{document.status}}
							{% else %} {% trans "No Document" %}
							{% endif %}
						</div>
					</div>

					<div class="flex gap-1 w-full">
						{% if document.document %}
							{% if perms.recruitment.change_candidatedocument %}
								{% if document.status == "approved" %}
									<button
										class="oh-btn flex-1 text-base bg-green-100 text-green-700 hover:bg-green-200 hover:scale-105 opacity-50 cursor-not-allowed"
										title="{% trans 'Approve' %}"
									>
										<ion-icon class="me-1" name="checkmark-outline"></ion-icon>
									</button>

									<button
										class="oh-btn flex-1 text-base bg-red-100 text-red-600 hover:bg-red-200 hover:scale-105 transition"
										hx-get="{% url 'candidate-document-reject' document.id %}"
										hx-target="#rejectFileForm"
										title="{% trans 'Reject' %}"
										onclick="event.stopPropagation()"
										hx-on-htmx-after-request="$('#rejectFileModal').toggleClass('oh-modal--show');"
									>
										<ion-icon class="me-1" name="close-outline"></ion-icon>
									</button>
								{% else %}
									<button
										class="oh-btn flex-1 text-base bg-green-100 text-green-700 hover:bg-green-200 hover:scale-105"
										hx-get="{% url 'candidate-document-approve' document.id %}"
										title="{% trans 'Approve' %}"
										onclick="event.stopPropagation()"
									>
										<ion-icon class="me-1" name="checkmark-outline"></ion-icon>
									</button>
									<button
										class="oh-btn flex-1 text-base bg-red-100 text-red-600 hover:bg-red-200 hover:scale-105 transition opacity-50 cursor-not-allowed"
										title="{% trans 'Reject' %}"
									>
										<ion-icon class="me-1" name="close-outline"></ion-icon>
									</button>
								{% endif %}
							{% endif %}
						{% else %}
							<button
								class="oh-btn flex-1 text-base bg-amber-100 text-amber-600 hover:bg-amber-200 hover:scale-105 transition"
								title="{% trans 'Upload Document' %}"
								hx-get="{% url 'candidate-file-upload' document.id %}"
								hx-target="#objectCreateModalTarget"
								data-document-id="{{ document.id }}"
								data-toggle="oh-modal-toggle"
								data-target="#objectCreateModal"
								onclick="event.stopPropagation()"
							>
								<ion-icon
									class="me-1"
									name="cloud-upload-outline"
								></ion-icon>
							</button>
						{% endif %}

						{% if perms.recruitment.delete_candidatedocument %}
							<form
								hx-confirm="{% trans 'Are you sure you want to delete this Document Request?' %}"
								hx-post="{% url 'candidate-document-delete' document.id %}"
								hx-target="#document{{document.id}}"
								hx-swap="outerHTML"
								hx-on-htmx-after-request="setTimeout(() => { reloadMessage(); }, 300);"
								onclick="event.stopPropagation()"
							>
								{% csrf_token %}
								<button
									type="submit"
									class="oh-btn text-base bg-slate-100 text-slate-500 hover:scale-105 hover:text-red-500 transition"
									title="{% trans 'Delete' %}"
								>
									<ion-icon class="me-1" name="trash-outline"></ion-icon>
								</button>
							</form>
						{% endif %}
					</div>
				</div>
			{% endfor %}
		</div>
	</div>

{% else %}

	<div class="oh-wrapper h-full" align="center">
		<div
			class="xl:col-span-4 md:col-span-6 col-span-12 bg-white p-6 rounded-md shadow-card h-[70%]"
		>
			<div class="flex flex-col items-center justify-center h-full">
				<img
					src="/static/horilla_theme/assets/img/no-records.svg"
					alt=""
					width="300"
					class="mb-4"
				/>
				<p class="text-[#666] mb-5">
					{% trans "No documents have been uploaded yet." %}
				</p>
			</div>
		</div>
	</div>

{% endif %}

<div
	class="oh-modal"
	id="viewFileModal"
	role="dialog"
	aria-labelledby="viewFileModal"
	aria-hidden="true"
>
	<div class="oh-modal__dialog custom-dialog">
		<div class="oh-modal__dialog-header">
			<span class="oh-modal__dialog-title" id="viewFileModalLabel"
				>{% trans "View File" %}</span
			>
			<button class="oh-modal__close" aria-label="Close">
				<ion-icon
					name="close-outline"
					role="img"
					class="md hydrated"
					aria-label="close outline"
				></ion-icon>
			</button>
		</div>
		<div class="oh-modal__dialog-body" id="viewFile"></div>
	</div>
</div>

<div
	class="oh-modal"
	id="documentCreateModal"
	role="dialog"
	aria-labelledby="documentCreateModal"
	aria-hidden="true"
>
	<div class="oh-modal__dialog" id="documentCreateForm">
	</div>
</div>


<div
	class="oh-modal"
	id="rejectFileModal"
	role="dialog"
	aria-labelledby="rejectFileModal"
	aria-hidden="true"
>
	<div class="oh-modal__dialog">
		<div class="oh-modal__dialog-header">
			<span class="oh-modal__dialog-title" id="rejectFileModalLabel"
				>{% trans "Reject" %}</span
			>
			<button class="oh-modal__close--custom" aria-label="Close"
			onclick="event.stopPropagation();event.preventDefault();$('#rejectFileModal').toggleClass('oh-modal--show');">
				<ion-icon
					name="close-outline"
					role="img"
					class="md hydrated"
					aria-label="close outline"
				></ion-icon>
			</button>
		</div>
		<div class="oh-modal__dialog-body" id="rejectFileForm"></div>
	</div>
</div>
