{% load static i18n basefilters %}
{% if groups %}
{% for group in groups %}

      <div class="accordion-item border border-primary-300 rounded-md" id="groupPanel{{group.id}}">

        <button
            onclick="event.preventDefault()"
            class="accordion-btn-gp w-full flex justify-between gap-5 md:gap-0 items-center flex-wrap px-4 py-2 bg-[#fff5f1] text-[#e54f38] text-sm transition-all">
            <div class="flex flex-wrap items-center gap-2">
                <span class="w-6 h-6 bg-primary-600 rounded-full text-white flex items-center justify-center text-xs">
                  <img src="https://ui-avatars.com/api/?name={{group}}"
                      class="oh-navbar__user-image w-6 h-6 rounded-full" loading="lazy">
                </span>
                <span class="font-semibold">{{group}}</span>
                <span class="text-xs mt-1 text-dark-300">{% trans "Total" %} {{group.user_set.all|length}} {% trans "users in this group" %}</span>
            </div>

            <div class="flex items-center flex-wrap gap-2 md:gap-8">
              <div class="flex gap-1 items-center">
                {% if perms.auth.change_group %}
                  <a class="cursor-pointer px-2 py-1 text-sm bg-white shadow-card text-primary-600 rounded-sm w-7 h-7 flex items-center justify-center
                            hover:bg-primary-600 hover:text-white transition duration-300"
                     hx-get="{% url "user-group-assign" %}"
                     hx-vals='{"group":"{{group.id}}"}'
                     hx-target="#groupAssignBody"
                     data-toggle="oh-modal-toggle"
                     data-target="#groupAssign"
                     onclick="event.stopPropagation()">
                    <i class="fa-solid fa-user-plus"></i>
                  </a>
                {% endif %}

                {% if perms.auth.delete_group %}
                  <form id="delete-form-{{ group.id }}"
                        action="{% url 'user-group-delete' group.id %}"
                        method="post"
                        onsubmit="return confirm('Do you want to delete this group permission?')"
                        style="display: inline;">
                      {% csrf_token %}
                      <a href="#" class="cursor-pointer px-2 py-1 text-sm bg-white shadow-card text-primary-600 rounded-sm w-7 h-7 flex items-center justify-center
                            hover:bg-primary-600 hover:text-white transition duration-300" onclick="submitDeleteForm({{ group.id }}); event.stopPropagation();">
                            <i class="fa-solid fa-trash"></i>
                      </a>
                  </form>
                {% endif %}
              </div>

              <span class="icon text-xl font-bold">+</span>
            </div>

        </button>
       <div  class=" panel accordion-panel-gp max-h-0 overflow-hidden transition-all duration-300 bg-white px-4 text-sm text-gray-700" id="panel{{group.id}}" data-group-id="{{group.id}}" data-group-name="{{group.name}}">
         <div class="py-3">
           <script>
             $(document).ready(function () {
               checkSelected(`{{group.permissions.all|user_perms|safe}}`,"#panel{{group.id}}",true)
             });
           </script>
             {% include "base/auth/permission_table.html" %}
         </div>
       </div>
    </div>

{% endfor %}
{% else %}

<div class="oh-wrapper h-full" align="center">
    <div class="xl:col-span-4 md:col-span-6 col-span-12 bg-white p-6 rounded-md shadow-card h-[70%]">
        <div class="flex flex-col items-center justify-center h-full">
            <img src="/static/horilla_theme/assets/img/no-records.svg" alt="" width="300" class="mb-4">
            <p class="text-[#666] mb-5">{% trans "There is no employee group at this moment." %}</p>
        </div>
    </div>
</div>

{% endif %}

{% if groups %}
  <div class="flex justify-between items-center mt-4 w-full bottom-0 inset-0">
    <!-- Left: Page status -->
    <p class="text-xs text-[#666]">
      {% trans "Page" %} {{ groups.number }} {% trans "of" %} {{ groups.paginator.num_pages }}
    </p>

    <!-- Right: Pagination controls -->
    <div class="text-sm flex gap-3 text-[#666] items-center">
      <!-- Previous -->
      {% if groups.has_previous %}
        <button
          hx-get="{% url 'user-group-search' %}?{{ pd }}&page={{ groups.previous_page_number }}"
          hx-target="#permissionContainer"
          class="text-xs hover:text-primary-600 transition duration-300"
          title="{% trans 'Previous Page' %}">
          <i class="fa-solid fa-arrow-left"></i>
        </button>
      {% else %}
        <button class="text-xs text-gray-300 cursor-not-allowed" disabled>
          <i class="fa-solid fa-arrow-left"></i>
        </button>
      {% endif %}

      <!-- Current / Total -->
      <span class="text-xs">
        {{ groups.number }} / {{ groups.paginator.num_pages }}
      </span>

      <!-- Next -->
      {% if groups.has_next %}
        <button
          hx-get="{% url 'user-group-search' %}?{{ pd }}&page={{ groups.next_page_number }}"
          hx-target="#permissionContainer"
          class="text-xs hover:text-primary-600 transition duration-300"
          title="{% trans 'Next Page' %}">
          <i class="fa-solid fa-arrow-right"></i>
        </button>
      {% else %}
        <button class="text-xs text-gray-300 cursor-not-allowed" disabled>
          <i class="fa-solid fa-arrow-right"></i>
        </button>
      {% endif %}
    </div>
  </div>
{% endif %}

<script>
  function submitDeleteForm(groupId) {
    const form = document.getElementById(`delete-form-${groupId}`);
    if (form) {
      form.requestSubmit();  // triggers `onsubmit`, works like real button click
    }
  }
</script>
