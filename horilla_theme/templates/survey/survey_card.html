{% load i18n %} {% load static %}
<style>
    .oh-kanban-card__title {
        width: 280px;
    }
</style>

{% include 'filter_tags.html' %}
<div class="oh-tabs__content hidden" id="templateTab">
    {% include "survey/template_accordion.html" %}
</div>
<div class="oh-tabs__content hidden" id="questionTab">
    {% if questions %}
        <div id="gridView" class="p-5">
            <div class="grid grid-cols-4 gap-4">
                {% for question in questions %}
                    <div class="border border-[#ebebeb] p-4 rounded-md shadow-card"
                        data-toggle="oh-modal-toggle"
                        data-target="#genericModal"
                        hx-get="{% url 'single-survey-view' question.id %}?instance_ids={{requests_ids}}"
                        hx-target="#genericModalBody"
                    >
                        <div class="flex gap-5 relative z-0">
                            <span class="absolute -left-3 -top-3 bg-green-500 w-2 h-2 rounded-full"></span>
                            {% if perms.recruitment.delete_recruitmentsurvey or perms.recruitment.change_recruitmentsurvey or perms.recruitment.add_recruitmentsurvey %}
                                <div class="absolute inline-block dropdown-wrapper right-0 -top-1">
                                    <a class="cursor-pointer dropdown-toggle">
                                        <i class="fa-solid fa-ellipsis-vertical text-black"></i>
                                    </a>
                                    <div
                                        class="dropdown-menu absolute right-0 min-w-[100px] bg-white rounded-lg shadow-card py-2 hidden z-50 transition-all duration-200"
                                    >
                                        <ul class="text-xs">
                                            {% if perms.recruitment.change_recruitmentsurvey %}
                                                <li>
                                                    <button
                                                        class="w-full text-left px-3 py-1 hover:text-primary-600 transition duration-300"
                                                        hx-get="{% url 'recruitment-survey-question-template-edit' question.id %}"
                                                        data-toggle="oh-modal-toggle"
                                                        data-target="#genericModal"
                                                        hx-target="#genericModalBody"
                                                    >
                                                        {% trans "Edit" %}
                                                    </button>
                                                </li>
                                            {% endif %}
                                            {% if perms.recruitment.change_recruitmentsurvey %}
                                                <li>
                                                    <button
                                                        class="w-full text-left px-3 py-1 hover:text-primary-600 transition duration-300"
                                                        hx-get="{% url 'recruitment-survey-question-template-duplicate' question.id %}"
                                                        data-toggle="oh-modal-toggle"
                                                        data-target="#genericModal"
                                                        hx-target="#genericModalBody"
                                                    >
                                                        {% trans "Duplicate" %}
                                                    </button>
                                                </li>
                                            {% endif %}
                                            {% if perms.recruitment.delete_recruitmentsurvey %}
                                                <li>
                                                    <a href="{% url 'recruitment-survey-question-template-delete' question.id %}"
                                                        onclick="
                                                            event.preventDefault();
                                                            event.stopPropagation();
                                                            confirm('{% trans "Are you sure want to delete?" %}')
                                                        "
                                                        class="text-danger w-full text-left px-3 py-2"
                                                    >
                                                        {% trans "Delete" %}
                                                    </a>
                                                </li>
                                            {% endif %}
                                        </ul>
                                    </div>
                                </div>
                            {% endif %}
                            <div class="mr-2">
                                <h5 class="mb-1 font-medium text-sm">{{question}}</h5>
                                <p class="text-xs text-[#565E6C] mb-1">
                                    {% for rec in question.recruitment_ids.all %} {{rec}},&nbsp;
                                    {% endfor %}
                                </p>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>

        {% if questions.has_next or questions.has_previous %}
            {% if questions.paginator.count %}
                <div
                    class="flex justify-between items-center mt-4 w-full inset-0"
                >
                    <p class="text-xs text-[#666]">{% trans "Page" %} {{ questions.number }} {% trans "of" %} {{ questions.paginator.num_pages }}</p>
                    <div class="flex gap-3 text-[#666] items-center">
                        {% if questions.has_previous %}
                            <button
                                class="text-xs hover:text-primary-600 transition duration-300"
                                hx-get="{% url 'rec-filter-survey' %}?{{pd}}&page={{ questions.previous_page_number }}"
                                hx-target="#view-container"
                            >
                                <i class="fa-solid fa-arrow-left"></i>
                            </button>
                        {% endif %}
                        <div>
                            <input
                                type="number"
                                name="page"
                                class="w-[30px]"
                                value="{{questions.number}}"
                                hx-get="{% url 'rec-filter-survey' %}?{{pd}}"
                                hx-target="#view-container"
                                min="1"
                            /> / {{ questions.paginator.num_pages }}
                            </div>
                        {% if questions.has_next %}
                            <button
                                class="text-xs hover:text-primary-600 transition duration-300"
                                hx-get="{% url 'rec-filter-survey' %}?{{pd}}&page={{ questions.next_page_number }}"
                                hx-target="#view-container"
                            >
                                <i class="fa-solid fa-arrow-right"></i>
                            </button>
                        {% endif %}
                    </div>
                </div>
            {% endif %}
        {% endif %}
    {% else %}
        <div class="oh-wrapper h-full" align="center" >
            <div class="xl:col-span-4 md:col-span-6 col-span-12 bg-white p-6 rounded-md shadow-card h-[70%]">
                <div class="flex flex-col items-center justify-center h-full">
                    <img src="/static/horilla_theme/assets/img/no-records.svg" alt="" width="300" class="mb-4">
                    <p class="text-[#666] mb-5">{% trans "No records available at the moment" %}</p>
                    {% include "generic/import_block.html" %}
                </div>
            </div>
        </div>
    {% endif %}

    <script>
        $(document).ready(function () {
            $(".oh-tabs__content").hide();
            var activeTab = localStorage.getItem("activeSurveyTab")
            $(".bg-primary-300").removeClass("bg-primary-300");
            $(`[data-target='${activeTab}']`).addClass("bg-primary-300");
            setTimeout(function () {
                $(`[data-target='${activeTab}']`).click();
            }, 50);

            $(".oh-tabs__tab").on("click", function (e) {
                var dataTarget = $(this).data('target');

                $(".oh-tabs__content").hide();
                $(this).addClass("bg-primary-300");
                $(".oh-tabs__tab").not(this).removeClass("bg-primary-300");
                $(dataTarget).show();
                localStorage.setItem("activeSurveyTab", dataTarget)
            });
        });
    </script>
</div>
