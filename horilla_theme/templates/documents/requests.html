{% load i18n %} {% load horillafilters %} {% load basefilters %} {% load static %}
{% include 'generic/components.html'%}
{% include 'filter_tags.html' %}
<div class="oh-modal" id="viewFileModal" role="dialog" aria-labelledby="viewFileModal" aria-hidden="true">
	<div class="oh-modal__dialog custom-dialog">
		<div class="oh-modal__dialog-header">
			<span class="oh-modal__dialog-title" id="viewFileModalLabel">{% trans "View File" %}</span>
			<button class="oh-modal__close" aria-label="Close">
				<ion-icon name="close-outline" role="img" class="md hydrated" aria-label="close outline"></ion-icon>
			</button>
		</div>
		<div class="oh-modal__dialog-body" id="viewFile"></div>
	</div>
</div>
<div class="bg-white rounded-md shadow-card p-3">

    <div class="">
        {% if documents %}
        <div class="accordion-wrapper space-y-2">
            {% for document_list in documents reversed %}
            <form  action="{% url 'document-request-delete' document_list.list.0.document_request_id.id %}"
                    method="post" style="display: none;"
                    onsubmit="return confirm('{% trans "Are you sure you want to delete this Document Request?" %}');">
                        {% csrf_token %}
                    <button type="submit" id="deleteDocumentForm"  style="display: none;"  hidden></button>
            </form>
            <div class="accordion-item border border-primary-300 rounded-md">
                <button hx-on:click="toggleAccordion(this)"
                    class="accordion-btn w-full flex justify-between gap-5 md:gap-0 items-center flex-wrap px-4 py-2 bg-[#fff5f1] text-[#e54f38] text-sm transition-all">
                    <div class="flex flex-wrap items-center gap-2">
                        <input type="checkbox" name="select_all" value="" onclick="selectAllDocuments(event)"
                            class="custom-checkbox w-4 h-4 bg-[#E9EDF7] rounded-sm text-[#e54f38] cursor-pointer me-3" />
                        <span class="font-semibold "> {{document_list.grouper}}</span> <span title="{% trans 'Uploaded / Requested' %}"
                            class="text-sm text-dark-600 ps-2">	{{document_list.list.0.upload_documents_count}} / {{document_list.list|length}}</span>
                    </div>

                    <div>
                        <div class="relative inline-block dropdown-wrapper" onclick="event.stopPropagation();$(this).find('.dropdown-menu').toggleClass('hidden')">
                            <a class="cursor-pointer dropdown-toggle">
                                <i class="fa-solid fa-ellipsis-vertical text-black"></i>
                            </a>
                            <!-- Dropdown Content -->
                            <div
                                class="dropdown-menu hidden absolute right-0 min-w-[100px] bg-white rounded-lg shadow-card py-2 z-50 transition-all duration-200">
                                <ul class="text-xs">
                                    <li>
                                        <a data-target="#objectCreateModal"
                                            data-toggle="oh-modal-toggle"
                                            hx-get="{% url 'document-request-update' document_list.list.0.document_request_id.id %}"
                                            hx-target="#objectCreateModalTarget"
                                            class="w-full text-dark-600 flex justify-start text-left px-3 py-1 hover:text-primary-600 transition duration-300">{% trans "Edit" %}</a>
                                    </li>
                                    <li>
                                        <a  onclick="deleteDocument();"
                                        class="w-full text-dark-600 flex justify-start text-left px-3 py-1 hover:text-red-600 transition duration-300 cursor-pointer"
                                        >
                                        {% trans "Delete" %}
                                    </a>


                                    </li>
                                </ul>

                            </div>

                        </div>
                        <span class="icon text-xl font-bold ps-3">+</span>
                    </div>

                </button>
                <div
                    class="accordion-panel max-h-0 overflow-hidden transition-all duration-300 bg-white px-4 text-sm text-gray-700">
                    <div class="py-3">
                        {% for document in document_list.list %}
                        <div class="border border-dark-50 p-3 rounded-md mb-2 flex justify-between" hx-get='{% url "view-file" document.id %}'
                        hx-target="#viewFile" data-toggle="oh-modal-toggle" id="requestDocument{{document.id}}"
							data-target="#viewFileModal" >

                            <div class="flex gap-1">
                                <input type="checkbox" value="" id="{{ document.id }}" onchange="highlightRow($(this))" onclick="event.stopPropagation()"
                                    class="custom-checkbox w-4 h-4 bg-[#E9EDF7] rounded-sm text-[#e54f38] cursor-pointer me-3" />


                                    {% if document.document %}
                                        {% if document.status == "approved" %}
                                        <div class="me-2" title="{% trans 'Approved' %}">
                                            <img src="{% static 'horilla_theme/assets/img/icons/tick.svg' %}" alt="" width="30">
                                        </div>
                                        {% elif document.status == 'rejected' %}
                                        <div class="me-2" title="{% trans 'Rejected' %}">
                                            <img src="{% static 'horilla_theme/assets/img/icons/tick.svg' %}" alt="" width="30">
                                        </div>
                                        {% else %}
                                        <div class="me-2" title="{% trans 'File Uploaded' %}">
                                            <img src="{% static 'horilla_theme/assets/img/icons/image.svg' %}" alt="" width="30">
                                        </div>
                                        {% endif%}
                                    {% else %}
                                    <div class="me-2" title="{% trans 'Upload' %}" hx-get="{% url 'file-upload' document.id %}"
                                            hx-target="#genericModalBody"
                                            data-document-id="{{ document.id }}"
                                            data-toggle="oh-modal-toggle"
                                            data-target="#genericModal"
                                            onclick="event.stopPropagation()">
                                        <img src="{% static 'horilla_theme/assets/img/icons/plus.svg' %}" alt="" width="30">
                                    </div>
                                    {% endif %}



                                <div>
                                    <div class="flex flex-wrap justify-between relative">
                                        <h3 class="font-semibold text-sm mb-1">{{document.title}} -- {{document.employee_id.get_full_name}}</h3>

                                    </div>

                                    <p class="text-xs text-[#565E6C] mt-1">{{document.document_request_id.description|truncatechars:20}}</p>
                                </div>
                            </div>


                            <div class="flex justify-center gap-1">
                                {% if perms.horilla_document.change_documentrequest %}
                                    {% if document.status == "approved" or not document.document %}
                                        <button
                                            class="btn-square btn-square1 w-6 h-6  text-xs bg-[#07bd072e] text-[#00c700]  disable" ><i
                                                class="fa-solid fa-check"></i></button>
                                        {% else %}
                                        <button
                                            hx-confirm="{% trans 'Do you want to approve this request' %}"
                                            hx-get="{% url 'document-approve' document.id %}"
                                            hx-target="#viewFile"
                                            title="{% trans 'Approve' %}"
											onclick="event.stopPropagation()"
                                            class="btn-square btn-square1 w-6 h-6 cursor-pointer  text-xs bg-[#07bd072e] text-[#00c700]" ><i
                                            class="fa-solid fa-check"></i></button>
                                    {% endif %}
                                    {% if document.status == 'rejected' or not document.document %}
                                <button
                                    class="btn-square btn-square2 w-6 h-6 cursor-pointer  text-xs bg-[#ff000024] text-[red] disable " ><i
                                        class="fa-solid fa-xmark"></i></button>
                                        {% else %}
                                        <button
                                        hx-get="{% url 'document-reject' document.id %}"
                                        hx-confirm="{% trans 'Do you want to reject this request' %}"
                                        hx-target="#genericModalBody"
                                        data-toggle="oh-modal-toggle"
                                        data-target="#rejectFileModal"
                                        title="{% trans 'Reject' %}"
                                        onclick="event.stopPropagation()"
                                        class="btn-square btn-square2 w-6 h-6 cursor-pointer  text-xs bg-[#ff000024] text-[red] " ><i
                                            class="fa-solid fa-xmark"></i></button>
                                    {% endif%}
                                    {% endif %}
                                    <form
                                        hx-confirm="{% trans 'Are you sure you want to delete this Document Request?' %}"
                                        hx-post="{% url 'document-delete' document.id %}"
                                        hx-target="#requestDocument{{document.id}}"
                                        method='post'
                                        onclick="event.stopPropagation()"
                                        hx-swap="outerHTML"
                                        >
                                        {% csrf_token %}
                                            <button type="submit"
                                                class="btn-square btn-square3 w-6 h-6 cursor-pointer  text-xs bg-[#001aff24] text-[#001affd5] "><i
                                                    class="fa-solid fa-trash"></i></button>
                                    </form>


                            </div>


                        </div>
                       {% endfor%}
                       <div class="flex justify-between items-center mt-4 w-full  bottom-0 inset-0">
                        <p class="text-xs text-[#666]">{% trans "Page" %} {{ document_list.list.number }}
                            {%trans "of" %} {{document_list.list.paginator.num_pages }}</p>
                        <div class="text-sm flex gap-3 text-[#666] items-center">
                            {% if document_list.list.has_previous %}
                            <button class="text-xs hover:text-primary-600 transition duration-300"  hx-target="#view-container"
                            hx-get="{% url 'document-request-filter-view' %}?{{pd}}&{{document_list.dynamic_name}}={{ document_list.list.previous_page_number }}"><i
                                    class="fa-solid fa-arrow-left"></i></button>
                            {% endif %}
                            {{document_list.list.number}} / {{document_list.list.paginator.num_pages}}
                            {% if document_list.list.has_next %}
                            <button class="text-xs hover:text-primary-600 transition duration-300" hx-target="#view-container"
                            hx-get="{% url 'document-request-filter-view' %}?{{pd}}&{{document_list.dynamic_name}}={{ document_list.list.next_page_number }}"><i
                                    class="fa-solid fa-arrow-right"></i></button>
                            {% endif %}
                        </div>
                    </div>
                    </div>

                </div>

            </div>
            {% endfor %}


        </div>


    </div>
    <div class="flex justify-between items-center mt-4 w-full  bottom-0 inset-0">
        <p class="text-xs text-[#666]">{% trans "Page" %} {{ documents.number }} {% trans "of" %}
            {{ documents.paginator.num_pages }}</p>
        <div class="text-sm flex gap-3 text-[#666] items-center">
            {% if documents.has_previous %}
            <button class="text-xs hover:text-primary-600 transition duration-300" hx-get="{% url 'document-request-filter-view' %}?{{pd}}&page={{ documents.previous_page_number }}"><i
                    class="fa-solid fa-arrow-left"></i></button>
            {% endif %}
                    {{documents.number}} / {{documents.paginator.num_pages}}
            {% if documents.has_next %}
            <button class="text-xs hover:text-primary-600 transition duration-300" hx-target="#view-container"
            hx-get="{% url 'document-request-filter-view' %}?{{pd}}&page={{ documents.paginator.num_pages }}"><i
                    class="fa-solid fa-arrow-right"></i></button>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>

<script src="{% static '/document/actions.js' %}"></script>
<script src="{% static '/base/filter.js' %}"></script>


<script>

    function deleteDocument() {
        document.getElementById('deleteDocumentForm').click();
    }
</script>
